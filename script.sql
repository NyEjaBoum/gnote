-- Table des semestres
CREATE TABLE Semestre (
    ID NUMBER PRIMARY KEY,
    NOM VARCHAR(2),
    PARCOURS VARCHAR(100)
);

-- Table des matières avec contrainte unique sur l'ID
CREATE TABLE MATIERES (
    ID VARCHAR(50),
    ID_SEMESTRE NUMBER,
    CREDIT NUMBER,
    Optionnel NUMBER DEFAULT 0,
    grp_opt NUMBER,
    useAverage NUMBER(1) DEFAULT 0, ---max
    PRIMARY KEY (ID, ID_SEMESTRE),  -- Clé primaire composite
    FOREIGN KEY (ID_SEMESTRE) REFERENCES Semestre(ID)
);

CREATE TABLE NOTES (
    NOTE_ID NUMBER PRIMARY KEY,
    ETU VARCHAR2(50),
    ID_MATIERE VARCHAR2(50),
    ID_SEMESTRE NUMBER,
    VALEUR NUMBER(5,2),
    ANNEE NUMBER,
    FOREIGN KEY (ID_MATIERE, ID_SEMESTRE) REFERENCES MATIERES(ID, ID_SEMESTRE)
);

-------------------MYSQL

CREATE TABLE Etudiant (
      ETU VARCHAR(50) PRIMARY KEY,
      NOM VARCHAR(50),
      DATE_ENTREE DATE
);

---- asina table mode de payement hoe trimestriel annuel semestriel ---parametre isaky annee scolaire lay izy semestre lie am annee

CREATE TABLE AnneeScolaire(
    ID INT AUTO_INCREMENT PRIMARY KEY,
    NOM VARCHAR(50),
    DATE_DEBUT DATE,
    DATE_FIN DATE
);

INSERT INTO ANNEESCOLAIRE (NOM,DATE_DEBUT,DATE_FIN) VALUES ('2022-2023','2022-09-01','2023-08-31');
INSERT INTO ANNEESCOLAIRE (NOM,DATE_DEBUT,DATE_FIN) VALUES ('2023-2024','2023-09-01','2024-08-31');


---INSERT INTO ANNEESCOLAIRE VALUES (2024,2025,);

--- tokony id 12 par annee

---- isaky annee scolaire miova ecolage fa isaky promo sy semestre classe mitovy

CREATE TABLE Ecolage(
    ID INT AUTO_INCREMENT PRIMARY KEY,
    ID_ANNEE_SCOLAIRE INT,
    VALEUR DOUBLE,
    FOREIGN KEY (ID_ANNEE_SCOLAIRE) REFERENCES AnneeScolaire(ID)
);

INSERT INTO ECOLAGE (ID_ANNEE_SCOLAIRE,VALEUR) VALUES  (1,500);

---- id_ecolage zany == ecolage mois de inona

CREATE TABLE PayementEcolage(
    ID INT AUTO_INCREMENT PRIMARY KEY,
    ETU VARCHAR(50),
    ID_ANNEE_SCOLAIRE INT,
    MONTANT DOUBLE,
    RESTE DOUBLE DEFAULT 0,
    FOREIGN KEY (ID_ANNEE_SCOLAIRE) REFERENCES Ecolage (ID_ANNEE_SCOLAIRE),
    FOREIGN KEY (ETU) REFERENCES Etudiant (ETU)
);


CREATE TABLE ModePaiement (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    MODE VARCHAR(50) NOT NULL
);

-- Insertion des modes de paiement
INSERT INTO ModePaiement (MODE) VALUES
('Mensuel'),
('Trimestriel'),
('Semestriel'),
('Annuel');


-- CREATE TABLE DELIBERATION(         ---sauvegarde
--     DELIBERATION_ID NUMBER PRIMARy KEY,
--     ETU VARCHAR2(50),
--     ID_MATIERE VARCHAR2(50),
--     ID_SEMESTRE NUMBER,
--     VALEUR NUMBER(5,2),
--     FOREIGN KEY (ETU) REFERENCES Etudiants(ETU),
--     FOREIGN KEY (ID_MATIERE, ID_SEMESTRE) REFERENCES MATIERES(ID, ID_SEMESTRE)
-- );


CREATE TABLE DELIBERATION(         ---sauvegarde
   DELIBERATION_ID NUMBER PRIMARy KEY,
   ETU VARCHAR2(50),
   ID_MATIERE VARCHAR2(50),
   ID_SEMESTRE NUMBER,
   VALEUR NUMBER(5,2),
   FOREIGN KEY (ID_MATIERE, ID_SEMESTRE) REFERENCES MATIERES(ID, ID_SEMESTRE)
);

INSERT INTO NOTES (ETU, ID_MATIERE, VALEUR) VALUES ('3383', 'ORG101', 13.89);



ALTER TABLE RESULTAT
DROP COLUMN ID_RESULTAT;


---- Suppression de la clé primaire existante sur ETU
--ALTER TABLE Etudiants DROP PRIMARY KEY;
--
---- Ajout de la colonne idEtudiant comme clé primaire
--ALTER TABLE Etudiants ADD (idEtudiant NUMBER PRIMARY KEY);
--
---- Modification de la colonne ETU en VARCHAR(50)
--ALTER TABLE Etudiants MODIFY (ETU VARCHAR(10));



create sequence seqEtudiant start with 1 increment by 1;

--- insert into Etudiants
---INSERT NUMBERO ETUDIANTS VALUES(seqEtudiant.currval,'3383',1,'Ny Eja');

--- insert into semestre
INSERT INTO SEMESTRE VALUES (1,'S1','general');
INSERT INTO SEMESTRE VALUES (2,'S2','general');
INSERT INTO SEMESTRE VALUES (3,'S3','general');
INSERT INTO SEMESTRE VALUES (4,'S4','dev');
INSERT INTO SEMESTRE VALUES (5,'S5','dev');
INSERT INTO SEMESTRE VALUES (6,'S6','dev');

INSERT INTO SEMESTRE VALUES (7,'S4','bdd');
INSERT INTO SEMESTRE VALUES (8,'S5','bdd');
INSERT INTO SEMESTRE VALUES (9,'S6','bdd');

INSERT INTO SEMESTRE VALUES (10,'S4','web');
INSERT INTO SEMESTRE VALUES (11,'S5','web');
INSERT INTO SEMESTRE VALUES (12,'S6','web');

INSERT INTO ETUDIANTS VALUES('3383',1,'Ny Eja');
INSERT INTO ETUDIANTS VALUES('3389',1,'Ewan');
INSERT INTO ETUDIANTS VALUES('3330',1,'Vatosoa');
INSERT INTO ETUDIANTS VALUES('3332',1,'Tafita');
INSERT INTO ETUDIANTS VALUES('3335',1,'Bona');

INSERT INTO ETUDIANTS VALUES('3130',1,'Rejela');

INSERT INTO ETUDIANTS VALUES('ETU1',1,'TEST1');
INSERT INTO ETUDIANTS VALUES('ETU2',1,'TEST2');
INSERT INTO ETUDIANTS VALUES('ETU3',1,'TEST3');

---insert into matieres S1

INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF101',7,1,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF104',5,1,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF107',4,1,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('MTH101',4,1,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('MTH102',6,1,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG101',4,1,0);


---insert into matieres S2
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF102',5,2,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF103',5,2,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF105',4,2,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF106',6,2,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('MTH103',6,2,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('MTH105',4,2,0);

---insert into matieres s3
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF201',6,3,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES('INF202',6,3,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES('INF203',4,3,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES('INF208',6,3,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES('MTH201',4,3,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES('ORG201',4,3,0);



----DEV
----insert into matieres s4 dev
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF204',6,4,1,1);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF205',6,4,1,1);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF206',6,4,1,1);

INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF207',6,4,0);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF210',10,4,0);

INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('MTH204',4,4,1,2);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('MTH205',4,4,1,2);
INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('MTH206',4,4,1,2);

INSERT INTO MATIERES(ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('MTH203',4,4,0);


-------------------alea

create sequence NOTE_SEQ START WITH 1 INCREMENT BY 1;

-- Insertion des notes avec NOTE_ID généré par la séquence
INSERT INTO NOTES (NOTE_ID, ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL, '3383', 'INF207', 4, 15.00);

INSERT INTO NOTES (NOTE_ID, ETU, ID_MATIERE, ID_SEMESTRE, VALEUR)
VALUES (NOTE_SEQ.NEXTVAL, '3383', 'INF210', 4, 16.00);

INSERT INTO NOTES (NOTE_ID, ETU, ID_MATIERE, ID_SEMESTRE, VALEUR)
VALUES (NOTE_SEQ.NEXTVAL, '3383', 'MTH203', 4, 16.00);

-- Groupe d'option 1 (INF) - L'étudiant doit choisir une matière
INSERT INTO NOTES (NOTE_ID, ETU, ID_MATIERE, ID_SEMESTRE, VALEUR)
VALUES (NOTE_SEQ.NEXTVAL, '3383', 'INF204', 4, 13.00);

INSERT INTO NOTES (NOTE_ID, ETU, ID_MATIERE, ID_SEMESTRE, VALEUR)
VALUES (NOTE_SEQ.NEXTVAL, '3383', 'INF205', 4, 12.00);

INSERT INTO NOTES (NOTE_ID, ETU, ID_MATIERE, ID_SEMESTRE, VALEUR)
VALUES (NOTE_SEQ.NEXTVAL, '3383', 'INF206', 4, 14.00);

-- Groupe d'option 2 (MTH) - L'étudiant doit choisir une matière
INSERT INTO NOTES (NOTE_ID, ETU, ID_MATIERE, ID_SEMESTRE, VALEUR)
VALUES (NOTE_SEQ.NEXTVAL, '3383', 'MTH204', 4, 11.00);

INSERT INTO NOTES (NOTE_ID, ETU, ID_MATIERE, ID_SEMESTRE, VALEUR)
VALUES (NOTE_SEQ.NEXTVAL, '3383', 'MTH205', 4, 14.00);

INSERT INTO NOTES (NOTE_ID, ETU, ID_MATIERE, ID_SEMESTRE, VALEUR)
VALUES (NOTE_SEQ.NEXTVAL, '3383', 'MTH206', 4, 3.00);



---S5 DEV
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF301',6,5,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF304',6,5,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF307',6,5,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG301',5,5,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG302',4,5,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG203',3,5,0);

---S6 DEV

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF310',4,6,0);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF313',6,6,0);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF302',6,6,1,1);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF303',6,6,1,1);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF316',10,6,0);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG304',4,6,0);



---S4  BDD ET RESEAUX
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF205',6,7,0);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF204',6,7,1,1);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF206',6,7,1,1);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF207',6,7,1,1);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF211',10,7,0);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('MTH202',4,7,1,2);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('MTH205',4,7,1,2);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('MTH206',4,7,1,2);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('MTH203',4,7,0);


---s5 bdd et reseaux
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF302',6,8,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF305',6,8,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF308',6,8,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG301',5,8,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG302',4,8,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG303',3,8,0);

---S6 bdd et reseaux

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF311',4,9,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF314',6,9,0);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF303',6,9,1,1);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF304',6,9,1,1);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF317',10,9,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG304',4,9,0);


---S4 WEB

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF204',6,10,1,1);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF205',6,10,1,1);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF206',6,10,1,1);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF209',6,10,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF212',10,10,0);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('MTH202',4,10,1,2);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('MTH204',4,10,1,2);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('MTH206',4,10,1,2);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('MTH203',4,10,0);


---S5 WEB

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF303',6,11,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF306',6,11,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF309',6,11,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG301',5,11,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG302',4,11,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG303',3,11,0);


----S6 WEB

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF312',4,12,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF315',6,12,0);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF302',6,12,1,1);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel,GRP_OPT) VALUES ('INF304',6,12,1,1);

INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('INF318',10,12,0);
INSERT INTO MATIERES (ID,CREDIT,ID_SEMESTRE,Optionnel) VALUES ('ORG304',4,12,0);



--- note avec coefficients

SELECT e.nom,e.ETU, (n.valeur * m.credit) as total
FROM ETUDIANTS e JOIN Matieres m on e.ID_SEMESTRE = m.ID_SEMESTRE
join Notes n on n.ID_MATIERE = m.ID where n.ID_MATIERE = 'MTH102' AND e.ETU = '3332';


-- Notes de l'étudiant 3383 pour le semestre 1
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'ORG101',1, 13.89);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH101',1, 11.00);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF101',1, 0);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH102',1, 5.60);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF107',1, 16.30);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF104',1, 13.25);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF101',1, 9.5);


-----3383 s4 dev
-- Matières obligatoires
--INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF207', 4, 15.50);
--INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF210', 4, 12.75);
--INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH203', 4, 11.25);
--
---- Groupe d'option 1 (INF) - L'étudiant doit choisir une matière
--INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF204', 4, 14.00);
--INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF205', 4, 8.50);
--INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF206', 4, 16.75);
--
---- Groupe d'option 2 (MTH) - L'étudiant doit choisir une matière
--INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH204', 4, 13.25);
--INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH205', 4, 9.75);
--INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH206', 4, 15.00);

----s4 bdd
-- Insertion de notes pour l'étudiant avec les matières du semestre 7
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF204', 7, 14.50);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF206', 7, 13.75);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF207', 7, 16.00);


INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH202', 7, 12.50);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH205', 7, 9.25);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH206', 7, 14.00);

INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF211', 7, 15.25);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH203', 7, 11.75);



 ---Notes de l'étudiant 3383 pour le semestre 2
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH103',2, 8.00);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF106',2, 1.75);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF105',2, 5.00);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF103',2, 10);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'MTH105',2, 19);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF102',2, 15);
INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF106',2, 12.75);

---Notes de l'etudiant 3332 pour le semestre 1
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3332', 'ORG101',1, 14.00);
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3332', 'INF107',1, 14.00);
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3332', 'INF101',1, 6.00);
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3332', 'INF104',1, 10.00);
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3332', 'MTH101',1, 9.00);
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3332', 'MTH102',1, 10.00);



---Notes etudiant 3332 pour le semestre 2
INSERT INTO NOTES (ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES ('3332','INF105',2,5);
INSERT INTO NOTES (ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES ('3332','INF103',2,8);
INSERT INTO NOTES (ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES ('3332','INF106',2,9);
INSERT INTO NOTES (ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES ('3332','MTH105',2,16.5);
INSERT INTO NOTES (ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES ('3332','MTH103',2,11);
INSERT INTO NOTES (ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES ('3332','INF102',2,16.50);

---3389
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3389', 'ORG101',1, 11.61);
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3389', 'MTH101',1, 4);
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3389', 'INF101',1, 0);
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3389', 'MTH102',1, 7.2);
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3389', 'INF107',1, 16.34);
INSERT INTO NOTES (ETU, ID_MATIERE,ID_SEMESTRE, VALEUR) VALUES ('3389', 'INF104',1, 13.25);


---BONA 3335  S1
INSERT INTO NOTES(NOTE_ID,ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3335','INF107',1,16.04);
INSERT INTO NOTES(NOTE_ID,ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3335','INF107',1,19.04);

INSERT INTO NOTES(NOTE_ID,ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3335','INF104',1,7.25);
INSERT INTO NOTES(NOTE_ID,ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3335','MTH101',1,2);
INSERT INTO NOTES(NOTE_ID,ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3335','INF101',1,1);
INSERT INTO NOTES(NOTE_ID,ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3335','ORG101',1,12.30);
INSERT INTO NOTES(NOTE_ID,ETU,ID_MATIERE,ID_SEMESTRE,VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3335','MTH102',1,4.6);



---------------------> deliberation 
create sequence seqDeliberation start with 1 increment by 1;

INSERT INTO DELIBERATION
SELECT * FROM NOTES WHERE ETU = '3383' AND ID_SEMESTRE = 1;

SELECT m.GRP_OPT, MAX(n.VALEUR) AS MAX_NOTE FROM MATIERES m JOIN NOTES n ON m.ID = n.ID_MATIERE WHERE m.GRP_OPT = 1 AND m.ID_SEMESTRE = 7 limit 2 GROUP BY m.GRP_OPT;



SELECT AVG(test) FROM (
    SELECT m.GRP_OPT, n.VALEUR as test
    FROM MATIERES m
    JOIN NOTES n ON m.ID = n.ID_MATIERE
    WHERE m.GRP_OPT = 1
    AND m.ID_SEMESTRE = 7
    ORDER BY n.VALEUR DESC
) WHERE ROWNUM <= 2;



SELECT * FROM NOTES n1
WHERE ETU = '3383'
  AND ID_MATIERE = 'INF205'
  AND VALEUR = (
      SELECT MAX(VALEUR)
      FROM NOTES n2
      WHERE n2.ETU = n1.ETU
        AND n2.ID_MATIERE = n1.ID_MATIERE
        AND n2.ID_SEMESTRE <= 7
  )
  AND ROWNUM = 1;



SELECT ID, test, AVG(test)
FROM (
    SELECT m.ID AS ID, m.GRP_OPT, n.VALEUR as test
    FROM MATIERES m
    JOIN NOTES n ON m.ID = n.ID_MATIERE
    WHERE m.GRP_OPT = 1
    AND m.ID_SEMESTRE = 7
    ORDER BY n.VALEUR DESC
) WHERE ROWNUM <= 2;




INSERT INTO NOTES (NOTE_ID,ETU, ID_MATIERE, ID_SEMESTRE, VALEUR) VALUES (NOTE_SEQ.NEXTVAL,'3383', 'INF207', 4, 18.50);


INSERT INTO DELIBERATION
SELECT * FROM NOTES WHERE ETU = '3383' AND ID_SEMESTRE = 1;



SELECT AVG(n.valeur) as val, m.id as nom  
FROM notes n  
JOIN matieres m ON n.id_matiere = m.id  
WHERE n.id_matiere = 'INF101' 
  AND n.id_semestre = 1
GROUP BY m.id;
